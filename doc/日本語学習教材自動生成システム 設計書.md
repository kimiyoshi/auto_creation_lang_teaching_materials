
# **日本語学習教材自動生成システム 設計書**

## **1. プロジェクト概要**

### **目的**

本プロジェクトでは、N5レベルの日本語学習教材をAI＋プログラムを活用して完全自動生成することを目指す。

### **目標**

1. **スキャン画像からテキストをOCR処理**し、日本語の文法ポイントを抽出
2. **GPT-4を使用し、文法スクリプトを自動生成**
3. **スライドを動的に作成**し、文法解説を視覚化
4. **HeyGen APIを使用し、複数アバターを用いた動画を自動生成**
5. **スライドと動画の同期を自動調整**
6. **MoodleにH5P/SCORM形式で登録し、学習管理**
7. **クイズを自動生成し、H5Pの「Drag the Words」を活用して文法構造を並べ替える形式で実施**
8. **次の課に進むための確認テストをMoodleのActivityで実施し、成績管理を行う**

---

## **2. システムアーキテクチャ**

### **技術スタック**

| 機能                | 技術候補                                            |
| ----------------- | ----------------------------------------------- |
| **OCR（スキャン画像解析）** | Tesseract OCR                                   |
| **文法解析・スクリプト生成**  | GPT-4 API                                       |
| **スライド生成**        | Google Slides API                               |
| **動画生成**          | HeyGen API（複数アバター対応）                            |
| **動画とスライドの同期**    | 動画音声解析 + JSONで同期情報管理                            |
| **Moodle自動登録**    | Moodle API（SCORM, H5P）                          |
| **クイズ自動生成**       | GPT-4 + H5P（Drag the Words, Dialog Cards）       |
| **確認テストの実施**      | Moodleの「クイズ」Activity（Multiple Choice, Ordering） |
| **データストレージ**      | **さくらのVPSのサーバー内ハードディスク**                 |
| **プロジェクト管理**      | GitHub Issues                                   |

---

## **3. データストレージの運用方針**

### **ストレージ構成**

本システムでは、**さくらのVPSのサーバー内ハードディスクをストレージとして利用**する。

- **Moodleのデータストレージと共用するか？**
  - **成績データやクイズ結果などのMoodleネイティブのデータはMoodleのストレージに保存**。
  - **動画、スライド、OCRデータなどの大容量コンテンツはサーバー内のハードディスクに保存**し、Moodleにはメタデータを登録。

- **ストレージ構造**
  - `/var/www/moodledata/external_storage/` → **教材データ（OCR結果・動画・スライド）**
  - `/var/www/moodledata/` → **Moodle内部データ（成績・学習履歴）**

- **データの可用性とバックアップ**
  - **定期的なバックアップを別のストレージ（外付けHDDやクラウド）に保存**
  - `rsync` や `cron` を用いた自動バックアップスクリプトを導入

- **Moodleとの連携**
  - **Moodleにはメタデータ（ファイルパス）を保存し、教材データは外部ストレージから提供**
  - MoodleのAPI経由でストレージにあるデータを読み込む仕組みを構築

---
## **4. 確認テストの仕様**

### **合格点とアクセス制限**
- **合格基準:** 各テストの **正答率 80%以上** を合格ラインとする。
- **再試行回数:** 不合格の場合、**最大3回まで再試行可能**。
- **アクセス制限:**
  - **未受験または不合格の場合、次の課に進めない**。
  - **合格後に次の課のコンテンツ（動画・スライド・クイズ）が開放される**。
  - **前の課の復習はいつでも可能**。

### **確認テストの構成**
| クイズの種類 | 内容 | 使用するMoodle Activity |
|------------|-------------------------|-------------------------|
| **単語テスト** | 単語の意味や発音を問う | **「クイズ」 + Multiple Choice** |
| **文法テスト** | 文法の正しい使い方を問う | **「クイズ」 + 並べ替え問題（Ordering Question）** |
| **会話テスト** | 会話の正しい順番を問う | **「クイズ」 + H5PのDialog Cardsを埋め込み** |


## **5. システム構成**

```
ユーザー（学習者）
    │
    ├── Moodle（学習管理システム）
    │     ├── SCORM/H5Pによるコンテンツ配信
    │     ├── クイズモジュール（Drag the Words, Dialog Cards）
    │     ├── 確認テスト（Moodleの「クイズ」Activityを利用）
    │     ├── API経由での動画・スライド登録
    │
    ├── 自動教材生成システム（バックエンド）
    │     ├── OCR処理（Tesseract OCR）
    │     ├── 文法解析・スクリプト生成（GPT-4 API）
    │     ├── スライド生成（Google Slides API）
    │     ├── HeyGen APIでの複数アバター動画生成
    │     ├── スライドと動画の同期処理
    │     ├── Moodle APIを使用した登録処理
    │
    ├── データストレージ（さくらのVPS）
    │     ├── `/var/www/moodledata/external_storage/`（教材データ）
    │     ├── `/var/www/moodledata/`（成績・学習履歴）
```

---

以上の内容で設計書を更新しました。
**さくらのVPSを使用する前提で、データストレージの運用方針を明確化**しました。
この構成で問題ないかご確認ください！



---

## **5. GitHub Issues タスク一覧**

| タスク名 | 概要 | 優先度 |
|----|----|----|
| **OCR処理の実装** | Tesseract OCRを使用し、スキャン画像からテキストを抽出 | ⭐⭐⭐ |
| **文法スクリプトの自動生成** | GPTを使い、文法ポイントごとに説明スクリプトを作成 | ⭐⭐⭐ |
| **スライド生成の自動化** | Google Slides APIを使用し、文法説明スライドを自動作成 | ⭐⭐ |
| **HeyGen APIによる動画生成** | **複数アバターを用いた動画を生成するAPIを実装** | ⭐⭐⭐ |
| **スライドと動画の同期処理** | HeyGenの音声長に基づいてスライド切り替えを調整 | ⭐⭐ |
| **Moodle API連携** | SCORM/H5Pフォーマットで動画をエクスポートし、自動登録 | ⭐⭐ |
| **クイズの自動生成** | GPTを使用し、H5P（Drag the Words, Dialog Cards）でクイズを作成し、Moodleに登録 | ⭐ |
| **確認テストの実装** | Moodleの「クイズ」Activityを活用し、成績管理を含む確認テストを作成 | ⭐⭐⭐ |

---

## **6. 次のステップ**

### **1. 設計書のレビューと確定**

- 設計内容の確認と修正
- GitHub Issuesの詳細化

### **2. 実装の開始**

- **OCR処理の開発**から順次実装
- 各機能ごとにGitHubでタスクを管理

### **3. テストとMoodle統合**

- **動画とスライドの同期確認**
- **Moodle上での動作テスト**
- **確認テストの動作確認と成績管理の検証**

