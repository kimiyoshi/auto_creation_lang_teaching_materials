# **[暫定]非機能要件定義書（NFR: Non-Functional Requirements）**

## **1. はじめに**
### **1.1 目的**
本ドキュメントは、日本語学習教材自動生成システムにおける非機能要件を定義する。パフォーマンス、スケーラビリティ、セキュリティ、可用性、運用・保守などの要件を明確にし、安定したシステム運用を実現することを目的とする。

### **1.2 対象範囲**
- **学習教材自動生成システム全体**（OCR, 文法解析, スライド・動画生成, クイズ登録, Moodle連携）
- **学習者向けMoodleシステム**（クイズ・確認テスト・成績管理）
- **管理者向け承認・修正システム**

---

## **2. パフォーマンス要件**
### **2.1 教材生成の処理速度**
| 項目 | 目標値 |
|------|--------|
| OCR処理時間（1課分） | **30秒以内** |
| 文法解析・スクリプト生成時間 | **15秒以内** |
| スライド生成時間 | **20秒以内** |
| 動画生成時間（HeyGen API） | **3分以内** |
| クイズ登録処理（Moodle API） | **30秒以内** |

### **2.2 システム負荷と応答時間**
| 項目 | 目標値 |
|------|--------|
| クイズ開始時のロード時間 | **3秒以内** |
| クイズ結果の保存時間 | **2秒以内** |
| Moodle内のページ遷移時間 | **2秒以内** |

### **2.3 同時ユーザーアクセス**
| 項目 | 目標値 |
|------|--------|
| 同時アクセスユーザー数 | **100人**（スケールアップ可能） |
| 1時間あたりのクイズ受験数 | **500件** |
| 1時間あたりの動画再生回数 | **1,000回** |

---

## **3. スケーラビリティ要件**
### **3.1 負荷分散の考慮**
- **VPSのリソース増強計画**（CPU・メモリ・ディスク使用率が80%を超えたら増強）
- **動画配信の最適化**（キャッシュサーバー導入を検討）

### **3.2 データ保存容量の管理**
| 項目 | 目標値 |
|------|--------|
| 1ユーザーあたりの教材データ量 | **100MB以下** |
| 動画・スライドの合計ストレージ容量 | **1TB以上** |

---

## **4. セキュリティ要件**
### **4.1 認証・認可**
- **Moodleのユーザー権限を厳密に管理**
- **管理者と学習者でアクセス制限を分離**
- **APIアクセス時の認証（APIキー・JWTトークンを利用）**

### **4.2 データ保護**
- **データ転送はTLS1.2以上で暗号化**
- **OCR・学習データは定期バックアップ（毎日1回）**
- **教材データの不正アクセス防止（IP制限・ログイン履歴監視）**

### **4.3 ログ管理**
| ログの種類 | 保存期間 | 保存場所 |
|------|--------|--------|
| 学習者のクイズ履歴 | **1年間** | MoodleDB |
| Moodle APIエラーログ | **6か月間** | `/var/log/moodle_api.log` |
| HeyGen APIエラーログ | **3か月間** | `/var/log/heygen_api.log` |

---

## **5. 可用性要件**
### **5.1 システム稼働率**
| 項目 | 目標値 |
|------|--------|
| システム稼働率 | **99.9%** |
| 障害時の復旧時間（RTO） | **1時間以内** |
| データ損失許容範囲（RPO） | **1時間以内** |

### **5.2 バックアップ計画**
| バックアップ対象 | 頻度 | 保存期間 |
|------|--------|--------|
| Moodleデータベース | **毎日1回** | **30日** |
| OCR処理データ | **毎週1回** | **90日** |
| 動画・スライドデータ | **毎月1回** | **180日** |

---

## **6. 運用・保守要件**
### **6.1 監視・アラート通知**
- **サーバーのCPU/メモリ使用率監視**（80%以上でアラート）
- **Moodle APIのレスポンス監視**（5秒以上遅延したら通知）
- **HeyGen APIエラー監視**（エラー率5%超過で通知）

### **6.2 ログ管理と分析**
- **アクセスログを分析し、異常検知**
- **ログの保存期間は3〜12か月とし、定期的にアーカイブ**

### **6.3 システム更新方針**
| 更新対象 | 更新頻度 | 備考 |
|------|--------|------|
| OS・セキュリティパッチ | **毎月1回** | さくらのVPS環境で適用 |
| Moodleプラグイン | **四半期ごと** | 互換性確認後に適用 |
| AIモデル（GPT-4） | **半年ごと** | 出力精度を確認し更新 |

---

## **7. 未決定の要件（検討が必要な事項）**
### **7.1 教材の保存期間**
- **生成された教材（スライド・動画）はどの期間保存するのか？**
- **学習者が退会した場合のデータ削除ポリシーはどうするか？**

### **7.2 負荷対策の追加施策**
- **VPSのスケールアップ基準をどのように決めるか？**
- **キャッシュを導入する場合、どのデータを対象とするか？**

### **7.3 学習者のプライバシー管理**
- **ログデータの匿名化が必要か？**
- **個人情報の取り扱いポリシーをどう設定するか？**

---

## **8. まとめと次のステップ**
📌 **決定が必要な事項の整理**
📌 **未決定の要件について関係者と議論**
📌 **最終版の非機能要件ドキュメントを確定**

---

このドラフトで問題ないかご確認ください！ **検討すべき点（7. 未決定の要件）について、決定が必要な項目を教えてください！**

